(()=>{"use strict";function t(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function e(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function n(t){"Escape"===t.key&&e(document.querySelector(".popup_is-opened"))}var o=document.querySelector("#card-template").content;function r(t,e,n,r,i){var a=o.querySelector(".card").cloneNode(!0),c=a.querySelector(".card__image"),u=a.querySelector(".card__title"),l=a.querySelector(".card__delete-button"),s=a.querySelector(".card__like-counter"),d=a.querySelector(".card__like-button");return u.textContent=t.name,c.src=t.link,c.alt=t.name,s.textContent=t.likes.length,t.owner._id===i?l.style.opacity=1:l.style.opacity=0,function(t,e,n){t.likes.some((function(t){return t._id===n}))&&e.classList.add("card__like-button_is-active")}(t,d,i),l.addEventListener("click",(function(){r(a.dataset.id)})),d.addEventListener("click",(function(){e(d,a,t)})),c.addEventListener("click",(function(){n(c.src,c.alt)})),a}function i(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function a(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))}function c(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(n){i(t,n,e)})),o.disabled=!0,o.classList.add(e.inactiveButtonClass)}var u="f9ca6a53-f7e2-4546-bfa9-36d832e0223d",l=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))};function s(t,e){return fetch("https://nomoreparties.co/v1/wff-cohort-38/"+t,e).then(l)}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var p,f,m,y=document.querySelector(".content"),v=y.querySelector(".places__list"),_=document.querySelector('[name="edit-profile"]'),h=document.querySelector('[name="new-place"]'),S=document.querySelector('[name="new-avatar"]'),b=y.querySelector(".profile__edit-button"),C=y.querySelector(".profile__add-button"),q=y.querySelector(".profile__title"),k=y.querySelector(".profile__description"),g=y.querySelector(".profile__image"),E=document.querySelector(".popup_type_edit"),x=document.querySelector(".popup_type_new-card"),L=document.querySelector(".popup_type_image"),A=document.querySelector(".popup_type_delete"),T=document.querySelector(".popup_type_avatar"),w=A.querySelector(".popup__button_confirm"),j=h.querySelector('input[name="place-name"]'),z=h.querySelector('input[name="place-link"]'),B=S.querySelector('input[name="avatar-link"]'),O=_.querySelector('input[name="name"]'),D=_.querySelector('input[name="description"]'),I=L.querySelector(".popup__image"),P=L.querySelector(".popup__caption"),M=Array.from(document.querySelectorAll(".popup")),N={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},J=[s("users/me",{method:"GET",headers:{authorization:u}}),s("cards",{method:"GET",headers:{authorization:u}})];function G(e){f=e,t(A)}function H(e,n){I.src=e,I.alt=n,P.textContent=n,t(L)}function U(t,e,n){var o=e.querySelector(".card__like-counter"),r=n._id;n.likes.some((function(t){return t._id===p}))?function(t){return s("cards/likes/".concat(t),{method:"DELETE",headers:{authorization:u}})}(r).then((function(e){t.classList.remove("card__like-button_is-active"),o.textContent=e.likes.length,n.likes=e.likes})).catch((function(t){console.log("Ошибка удаления лайка",t)})):function(t){return s("cards/likes/".concat(t),{method:"PUT",headers:{authorization:u}})}(r).then((function(e){t.classList.add("card__like-button_is-active"),o.textContent=e.likes.length,n.likes=e.likes})).catch((function(t){console.log("Ошибка добавления лайка",t)}))}Promise.all(J).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,i,a,c=[],u=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=i.call(n)).done)&&(c.push(o.value),c.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return c}}(e,n)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],a=o[1];p=i._id,q.textContent=i.name,k.textContent=i.about,g.style.backgroundImage="url(".concat(i.avatar,")"),a.forEach((function(t){var e=r(t,U,H,G,p);e.dataset.id=t._id,v.append(e)}))})).catch((function(t){console.log("Ошибка",t)})),M.forEach((function(t){var n=t.querySelector(".popup__close");t.classList.add("popup_is-animated"),n.addEventListener("click",(function(){return e(t)})),t.addEventListener("mousedown",(function(n){n.target===t&&e(t)}))})),b.addEventListener("click",(function(){O.value=q.textContent,D.value=k.textContent,c(_,N),t(E)})),_.addEventListener("submit",(function(t){t.preventDefault();var n,o,r=t.submitter.textContent;t.submitter.textContent="Сохранение...",(n=O.value,o=D.value,s("users/me",{method:"PATCH",headers:{authorization:u,"Content-Type":"application/json"},body:JSON.stringify({name:n,about:o})})).then((function(){q.textContent=O.value,k.textContent=D.value,t.submitter.textContent=r,e(E)})).catch((function(e){t.submitter.textContent="Ошибка сохранения",console.log("Ошибка",e)}))})),w.addEventListener("click",(function(){var t,n;f&&(t=f,n=w.textContent,w.textContent="Удаление...",function(t){return s("cards/".concat(t),{method:"DELETE",headers:{authorization:u}})}(t).then((function(o){if("Пост удалён"===o.message){var r=document.querySelector('.card[data-id="'.concat(t,'"]'));r?r.remove():console.log("Элемент с ID ".concat(t," не найден на странице")),w.textContent=n,e(A)}else w.textContent="Ошибка удаления",console.log("Ошибка удаления",o)})).catch((function(t){console.log("Ошибка",t)})))})),C.addEventListener("click",(function(){t(x)})),h.addEventListener("submit",(function(t){t.preventDefault();var n,o,i=t.submitter.textContent;t.submitter.textContent="Добавление карточки...",(n=j.value,o=z.value,s("cards",{method:"POST",headers:{authorization:u,"Content-Type":"application/json"},body:JSON.stringify({name:n,link:o})})).then((function(n){var o=r(n,U,H,G,p);v.prepend(o),h.reset(),c(h,N),t.submitter.textContent=i,e(x)})).catch((function(e){t.submitter.textContent="Ошибка добавления",console.log("Ошибка",e)}))})),g.addEventListener("click",(function(){t(T)})),S.addEventListener("submit",(function(t){t.preventDefault();var n=B.value.trim(),o=t.submitter.textContent;t.submitter.textContent="Обновление...",function(t){return s("users/me/avatar",{method:"PATCH",headers:{authorization:u,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})})}(n).then((function(){g.style.backgroundImage="url(".concat(n,")"),S.reset(),c(S,N),t.submitter.textContent=o,e(T)})).catch((function(e){t.submitter.textContent="Ошибка обновления аватара",console.log("Ошибка обновления аватара",e)}))})),m=N,Array.from(document.querySelectorAll(m.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);a(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?i(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),a(n,o,e)}))}))}(t,m)}))})();